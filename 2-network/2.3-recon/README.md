# Recon

## IP Addresses and Sub-domains

Usually one of the first steps in passive reconnaissance, it's important to identify the net ranges and sub-domains associated with your target(s) as this will help scope the remainder of your activities.

   - Use passive tools to collect the target's owned IP address blocks
       - IANA or one of their IRR's
           - IPV4 Address Space
           - IPV6 Unicast Address Assignments
       - IPinfo.io

   - Collect all the DNS domain and sub-domain names.
       - dig - Queries the DNS server over UDP port 53. You can pull various DNS records registered on the DNS server.
       - whois - Queries the DNS Registrar over TCP port 43.
           - A domain name registrar is a business that handles the reservation of domain names as well as the assignment of IP addresses for those domain names. A domain name registrar is a business that handles the reservation of domain names as well as the assignment of IP addresses for those domain names.
       - search.arin.net/rdap
       - whois.domaintools.com
       - viewdns.info
       - dnsdumpster.com
       - www.domainiq.com
       - viz.greynoise.io
       - search.censys.io
       - fullhunt.io
       - centralops.net/co
       - ipapi.is
       - ip-netblocks.whoisxmlapi.com/lookup

   - URL Scan:
       - Netcraft
       - urlscan.io
       - fofa.info
       - web-check.xyz
       - web-check.as93.net

   - Tools:

       - Fierce - is an IP and DNS recon tool is written in PERL, famous for helping IT sec professionals to find target IPs associated with domain names.
        Unicornscan - is one of the top intel-gathering tools for security research. It has also a built-in correlation engine that aims to be efficient, flexible and scalable at the same time.

   - IP GeoLocation lookup:

       - www.maxmind.com/en/locate-my-ip-address
       - iplocation.io
       - www.iplocation.net/ip-lookup
       - infosniper.net
       - db-ip.com

   - Trace the IP route to the target using:

       - Traceroute (using TCP, UDP or ICMP)
       - visualtraceroute.net
       - www.visualroute.com

   - BGP advertized prefixes

       - bgpview.io
       - hackertarget.com/as-ip-lookup
       - bgp.he.net
       - www.bgp4.as/tools

   - Wireless Networks

       - wigle.net
       - www.wifimap.io

## Identifying People

Identifying names, email addresses, phone numbers, and other personal information can be valuable for pretexting, phishing or other social engineering activities. Use open-source to collect information on subject browse social media sites:

   - Company website (example: link:www.ccboe.net[www.ccboe.net])

   - Third-party data repositories (companies that host data for your targeted organization)

   - Tools such as:
       - [Maltego](https://www.maltego.com/) - provides the ability to lookup email addresses based on a given domain.
       - [Recon-ng](https://github.com/lanmaster53/recon-ng) - built in the Kali Linux distribution to perform reconnaissance on remote targets.
       - [theHarvester](https://github.com/laramies/theHarvester) - fetch valuable information about any subdomain names, virtual hosts, open ports and email address of any company/website.
       - [Jigsaw](https://www.jigsawsecurityenterprise.com/) - gather information about any company employees. For companies like Google, Linkedin, or Microsoft, where you can just pick up one of their domain names (like google.com), and then gather all their employee's emails on the different company departments.
       - [SpiderFoot](https://www.spiderfoot.net/) - automate OSINT and have fast results for reconnaissance, threat intelligence, and perimeter monitoring.
       - [Creepy](https://www.geocreepy.com/) - geo-location OSINT tool for infosec professionals. It offers the ability to get full geolocation data from any individuals by querying social networking platforms like Twitter, Flickr, Facebook, etc.

   - Message boards:

   - User Forums:
       - www.mirc.com
       - discord.com
       - www.reddit.com

   - Search Engines:
       - www.google.com
       - www.bing.com
       - www.yahoo.com
       - duckduckgo.com
       - www.ask.com
       - search.brave.com
       - www.search.com
       - info.com - Meta Search engine (Google, Yahoo!, Ask, Bing, Yandex, Open Directory)
       - www.baidu.com - China
       - soso.com - China
       - www.sogou.com - China

## Google Hacking Database

   - dorksearch.com

   - Google dork cheatsheet
       
       - site:
```
site:.gov "Secret"
site:linkedin.com intitle:starbucks "network engineer"
```
   - intitle:
```
intitle:"Welcome to Windows 2000 Internet Services"
intitle:"Nessus Scan Report" "This file was generated by Nessus"
intitle:"index of" inurl:ftp
```
   - inurl:
```
inurl:admin/login
inurl:/admin.html
```
   - filetype:
```
filetype:pdf "Confidential"
filetype:ppt "Networking"
```

## Whois

RFC 3912 TCP-based transaction-oriented query/response protocol that is widely used to provide information services to Internet users. While originally used to provide "white pages" services and information about registered domain names, current deployments cover a much broader range of information services. The protocol delivers its content in a human-readable format.

The WHOIS lookup helps determine where the site is hosted, who owns the IP block, and may list organizational contacts that may be useful for social engineering.

WHOIS works by querying DNS registrars databases over TCP port 43.

   - A domain name registrar is a business that handles the reservation of domain names as well as the assignment of IP addresses for those domain names. Examples of Domain Registrars are:
       - [Domain.com](https://www.domain.com/)
       - [Bluehost](https://www.bluehost.com/)
       - [Network Solutions](https://www.networksolutions.com/)
       - [HostGator](https://www.hostgator.com/)
       - [GoDaddy](https://www.godaddy.com/)
       - [NameCheap](https://www.namecheap.com/)
       - [DreamHost](https://www.dreamhost.com/)
       - [BuyDomains](https://www.buydomains.com/)

Most whois queries will return false information as most people opt for privacy of their domain information in order to protect against email harvesting, spam, and social engineering attempts on the administrative contact.
```
instructor@net1:~$ whois ccboe.net
```

## DIG

Dig is a tool that returns key DNS information and can be used to query for specific records.
```
instructor@net1:~$ dig ccboe.net
instructor@net1:~$ dig ccboe.net MX
instructor@net1:~$ dig ccboe.net SOA
instructor@net1:~$ dig ccboe.net TXT
```

## More Google Dorking

Filetype Search:
   - Syntax: `filetype:`
   - Example: `filetype:pdf site:example.com`
   - Purpose: Finds specific file types on a given site.

Site-specific Search:
   - Syntax: `site:`
   - Example: `site:example.com`
   - Purpose: Limits the search to a specific website.

Intitle and Inurl Searches:
   - Syntax: `intitle:` and `inurl:`
   - Example: `intitle:"index of" inurl:backup`
   - Purpose: Searches for specific words in the title or URL.

Link Search:
   - Syntax: `link:`
   - Example: `link:example.com`
   - Purpose: Finds pages that link to a specified website.

Cache Search:
   - Syntax: `cache:`
   - Example: `cache:example.com`
   - Purpose: Displays the cached version of a webpage.

Related Search:
   - Syntax: `related:`
   - Example: `related:example.com`
   - Purpose: Finds websites similar to the specified domain.

Wildcard Search:
   - Syntax: `*`
   - Example: `site:example.*`
   - Purpose: Uses a wildcard to search across multiple top-level domains.

Combining Operators:
   - Syntax: `OR`, `-` (exclude), `+` (include)
   - Example: `site:example.com OR site:example.net -inurl:blog`
   - Purpose: Combines operators to refine search results.

Specific File Search:
   - Syntax: `ext:`
   - Example: `ext:sql`
   - Purpose: Finds specific file types.

## Ping Sweeps

Ping sweep

`-c (--count *count*)` - Stop after sending (and receiving) count.
```
for i in {1..254}; do (ping -c 1 192.168.65.$i | grep "bytes from" &) ; done
```
Using FPING:

`-g (--generate) 172.16.82.96/27` - Generate a target list from a supplied IP netmask, or a starting and ending IP.
`-a (--alive)` - Show systems that are alive.
```
fping -g -a 10.1.0.0/24
```
Using NMAP:

`-sn`: Ping Scan - disable port scan
```
nmap -sn 10.0.0.0/24 (was -sP which is now deprecated)
```

## NMAP

**Active External Network Reconnaissance: Scans with NMAP**

NMAP (Network Mapper) is a popular open source tool for network discovery, exploration and security auditing. NMAP is a command line tool but has a Graphical User Interface (GUI) version call ZENMAP that comes installed when NMAP is installed.

The default scanning method depends on whether the scan is executed as a user or root. When conducted as a user, the default scan employs a TCP full connect (-sT) as creating RAW SOCKETS, required for other scans, necessitates permissions that a user typically lacks. On the other hand, when executed as a root user, the default scan type is a SYN Scan (-sS). Regardless of the chosen scan method, if specific ports are not designated, NMAP will automatically scan the 1000 most commonly used TCP or UDP ports.

   - User Default: TCP Full Connect Scan (-sT)
   - Root Default: TCP SYN Scan (-sS)
   - Default Ports scanned: 1000 most commonly used TCP or UDP ports.
```
nmap -v -oG - | grep "Ports scanned"
```
    This list comes from the `/usr/share/nmap/nmap-services` file based on the frequency of detection.
```
sort -r -k3 /usr/share/nmap/nmap-services | less
grep /tcp /usr/share/nmap/nmap-services | sort -r -k3 | less 
grep /udp /usr/share/nmap/nmap-services | sort -r -k3 | less
```

### NMAP Options

   - TARGET SPECIFICATION:
```
Can pass hostnames, IP addresses, networks, etc.
Ex: scanme.nmap.org, microsoft.com/24, 192.168.0.1; 10.0.0-255.1-254
-iL <inputfilename>: Input from list of hosts/networks
-iR <num hosts>: Choose random targets
--exclude <host1[,host2][,host3],...>: Exclude hosts/networks
--excludefile <exclude_file>: Exclude list from file
```
   - HOST DISCOVERY:
```
-sL: List Scan - simply list targets to scan
-sn: Ping Scan - disable port scan
-Pn: Treat all hosts as online -- skip host discovery
-PS/PA/PU/PY[portlist]: TCP SYN/ACK, UDP or SCTP discovery to given ports
-PE/PP/PM: ICMP echo, timestamp, and netmask request discovery probes
-PO[protocol list]: IP Protocol Ping
-n/-R: Never do DNS resolution/Always resolve [default: sometimes]
--dns-servers <serv1[,serv2],...>: Specify custom DNS servers
--system-dns: Use OS's DNS resolver
--traceroute: Trace hop path to each host
```
   - SCAN TECHNIQUES:
```
-sS/sT/sA/sW/sM: TCP SYN/Connect()/ACK/Window/Maimon scans
-sU: UDP Scan
-sN/sF/sX: TCP Null, FIN, and Xmas scans
--scanflags <flags>: Customize TCP scan flags
-sI <zombie host[:probeport]>: Idle scan
-sY/sZ: SCTP INIT/COOKIE-ECHO scans
-sO: IP protocol scan
-b <FTP relay host>: FTP bounce scan
```
   - PORT SPECIFICATION AND SCAN ORDER:
```
-p <port ranges>: Only scan specified ports
Ex: -p22; -p1-65535; -p U:53,111,137,T:21-25,80,139,8080,S:9
--exclude-ports <port ranges>: Exclude the specified ports from scanning
-F: Fast mode - Scan fewer ports than the default scan
-r: Scan ports sequentially - don't randomize
--top-ports <number>: Scan <number> most common ports
--port-ratio <ratio>: Scan ports more common than <ratio>
```
   - SERVICE/VERSION DETECTION:
```
 -sV: Probe open ports to determine service/version info
--version-intensity <level>: Set from 0 (light) to 9 (try all probes)
--version-light: Limit to most likely probes (intensity 2)
--version-all: Try every single probe (intensity 9)
--version-trace: Show detailed version scan activity (for debugging)
```


   - SCRIPT SCAN:
```
-sC: equivalent to --script=default
--script=<Lua scripts>: <Lua scripts> is a comma separated list of
    directories, script-files or script-categories
--script-args=<n1=v1,[n2=v2,...]>: provide arguments to scripts
--script-args-file=filename: provide NSE script args in a file
--script-trace: Show all data sent and received
--script-updatedb: Update the script database.
--script-help=<Lua scripts>: Show help about scripts.
    <Lua scripts> is a comma-separated list of script-files or
     script-categories.
```
   - OS DETECTION:
```
-O: Enable OS detection
--osscan-limit: Limit OS detection to promising targets
--osscan-guess: Guess OS more aggressively
```
   - TIMING AND PERFORMANCE:
```
Options which take <time> are in seconds, or append 'ms' (milliseconds),
's' (seconds), 'm' (minutes), or 'h' (hours) to the value (e.g. 30m).
-T<0-5>: Set timing template (higher is faster)
--min-hostgroup/max-hostgroup <size>: Parallel host scan group sizes
--min-parallelism/max-parallelism <numprobes>: Probe parallelization
--min-rtt-timeout/max-rtt-timeout/initial-rtt-timeout <time>: Specifies
    probe round trip time.
--max-retries <tries>: Caps number of port scan probe retransmissions.
--host-timeout <time>: Give up on target after this long
--scan-delay/--max-scan-delay <time>: Adjust delay between probes
--min-rate <number>: Send packets no slower than <number> per second
--max-rate <number>: Send packets no faster than <number> per second
```

   - FIREWALL/IDS EVASION AND SPOOFING:
```
-f; --mtu <val>: fragment packets (optionally w/given MTU)
-D <decoy1,decoy2[,ME],...>: Cloak a scan with decoys
-S <IP_Address>: Spoof source address
-e <iface>: Use specified interface
-g/--source-port <portnum>: Use given port number
--proxies <url1,[url2],...>: Relay connections through HTTP/SOCKS4 proxies
--data <hex string>: Append a custom payload to sent packets
--data-string <string>: Append a custom ASCII string to sent packets
--data-length <num>: Append random data to sent packets
--ip-options <options>: Send packets with specified ip options
--ttl <val>: Set IP time-to-live field
--spoof-mac <mac address/prefix/vendor name>: Spoof your MAC address
--badsum: Send packets with a bogus TCP/UDP/SCTP checksum
```
   - OUTPUT:
```
-oN/-oX/-oS/-oG <file>: Output scan in normal, XML, s|<rIpt kIddi3,
    and Grepable format, respectively, to the given filename.
-oA <basename>: Output in the three major formats at once
-v: Increase verbosity level (use -vv or more for greater effect)
-d: Increase debugging level (use -dd or more for greater effect)
--reason: Display the reason a port is in a particular state
--open: Only show open (or possibly open) ports
--packet-trace: Show all packets sent and received
--iflist: Print host interfaces and routes (for debugging)
--append-output: Append to rather than clobber specified output files
--resume <filename>: Resume an aborted scan
--noninteractive: Disable runtime interactions via keyboard
--stylesheet <path/URL>: XSL stylesheet to transform XML output to HTML
--webxml: Reference stylesheet from Nmap.Org for more portable XML
--no-stylesheet: Prevent associating of XSL stylesheet w/XML output
```
   - MISC:
```
-6: Enable IPv6 scanning
-A: Enable OS detection, version detection, script scanning, and traceroute
--datadir <dirname>: Specify custom Nmap data file location
--send-eth/--send-ip: Send using raw ethernet frames or IP packets
--privileged: Assume that the user is fully privileged
--unprivileged: Assume the user lacks raw socket privileges
-V: Print version number
-h: Print this help summary page.
```

### SYN Scan

SYN scan sends only one TCP packet with the SYN flag set to each destination port and waits for a SYN/ACK or RST. This is also known as a Stealth Scan. This method reports if there is an application listening on the target port and does not register on the host system, because no ACK is sent to the target. This method does not retrieve any information about the service.
```
nmap -sS 172.16.82.106
hping3 172.16.82.106 -S -V -p 443
```

### Full Connect Scan

Full-Connect scan establishes a complete TCP three-way handshake with a system. The advantage of this method is that a fully functional connection to the target host is made which allows information to be gathered from the listening service (aka banner grabbing). The down side to this method is that the connection is logged on the system being targeted. If done many times, a netstat on that system shows many established connections between the source and target.
```
nmap -sT -sV 172.16.82.106
(Full TCP connect, service versioning)
nmap -sT 172.16.82.106
```

### Null Scan

A null scan has no flags set and a sequence number of 0. All legitimate traffic has flags set, causing any null scan traffic to stand out if viewed. This scan is useful to penetrate firewalls and routers set to filter certain flags out since it uses no flags. Open and filtered ports should have no response, filtered ports may also send an ICMP unreachable message, and closed ports should send a RST packet.
```
nmap -sN 172.16.82.106
hping3 -c 1 -V -p 80 -s 5050 -Y 172.16.82.106
```

### FIN Scan

A FIN scan is a packet with just the FIN flag set. The packet tries to close a connection that does not exist as a way to obtain information. Like the null scan it works to go through firewalls and routers, in addition to being considered stealthier due to the illegal flag combination. Open and filtered ports should have no response, filtered ports may also send an ICMP unreachable message, and closed ports should send a RST packet.
```
nmap -sF 172.16.82.106
hping3 -c 1 -V -p 80 -s 5050 -F 172.16.82.106
```

### XMAS Tree Scan

A christmas tree scan is a packet with varying definitions. From nmap it is defined as a packet with FIN, PSH, and URG flags set, while ISS (IBM Internet Security Systems) defines it as all flags are set. Open and filtered ports should have no response, filtered ports may also send an ICMP unreachable message, and closed ports should send a RST packet.
```
nmap -sX 172.16.82.106
hping3 -c 1 -V -p 80 -s 5050 -M 0 -UPF 172.16.82.106
```

### UDP Scan

A UDP Scan can be used to find *nix hosts that are blocking TCP and ICMP traffic. Since UDP is a stateless protocol it is often used to get through stateful firewalls. This kind of scan is not very useful for service discovery because UDP is connection-less. UDP is dependent on the application as to how or if there is a response.
```
nmap -sU -v 172.16.82.106
```

### Idle Scan

An idle scan is a more complex stealth technique that utilizes the previously discussed SYN scan. The scan aims to gather port information using a zombie station on the network where the scanning process appears to have been initiated by the zombie IP address instead of the actual source station who will spoof this address later in the process. This scanning method exploits IP fragmentation identification sequences and implements IP address spoofing.
```
nmap -sI 172.16.40.10 172.16.82.106
```

### Decoy scan

A decoy scan sends multiple packets to each port with different source addresses. This makes it difficult to detect the source but generates lot of traffic. Using ME in your IP list specifies where it is used in the order, and with larger amounts of IPs can mean that yours will not display.
```
nmap -D 1.2.3.4,5.6.7.8,ME 172.16.82.106
```

### Window Scan

A window scan functions like an ACK scan but uses the windows size of the responses to determine whether it is open or closed. An ACK scan returns most results as filtered and can be fairly inaccurate. By using the window size the scan can better determine if it is open, closed, or filtered. If the window field is non zero it will display as open, a zero window field will display as closed, and either no response or ICMP unreachable will display as filtered.
```
nmap -sW 172.16.82.106
```

### RPC scan

A RPC scan is looking for services that use RPC (remote Procedure Call). The RPC scan is designed to discover RPC services and their corresponding RPC programs, versions, and sometimes even specific vulnerabilities. This can be useful for network enumeration, identifying exposed RPC services, and assessing security risks.

RPC allows for remote commands to be run on machines and this scan will determine the services and version of the service when run. In updated versions of nmap -sR is aliased to -sV (version scanning) and activates version scanning with the RPC scanning.
```
nmap -sR 172.16.82.106
```

### FTP bounce scan

An FTP bounce scan, also known as a proxy scan, is a technique used by Nmap to scan networks indirectly through an FTP server. This method can be useful when direct scanning is blocked or difficult due to network restrictions.

FTP Bounce: An attack technique that takes advantage of the FTP server's ability to open connections to arbitrary ports on other systems. It utilizes the FTP PORT command to route traffic through the FTP server, potentially bypassing firewalls and other network security measures. The primary use of an FTP Bounce scan is to perform port scanning on target systems that may be behind firewalls or other network defenses. By using the FTP server as a proxy, it can sometimes scan ports that are not directly accessible from the attacker's network.
```
nmap -b <name>:<pass>@<ftp_server> <victim>
nmap -v -p 21,22,445,80,443 -b student:password@172.16.40.10 192.168.0.0/24
```

### OS fingerprinting scan

An OS fingerprinting scan uses TCP/IP stack fingerprinting to determine what OS is being used. By sending TCP and UDP packets it gathers information such as window size, TCP option ordering and IP ID sampling. It runs that information against its OS database. If a match is found it provides Vendor, OS, Generation, and device type.
```
nmap -O 172.16.82.106
```

### Version scan

A version scan uses open ports and the nmap-service-probes databases to query services to confirm the service running on a port and provide the version of the service running. This allows exploits to be properly chosen for use since different versions and patches are susceptible to different things.
```
nmap -sV 172.16.82.106
```

### Maimon scan

The Maimon scan is named after its discoverer, Uriel Maimon. This technique is exactly the same as NULL, FIN, and Xmas scan, except that the probe is FIN/ACK. It is meant to determine open and closed ports on BSD derived systems. Other systems will generate a RST packet regardless of the port's state. No response indicates either open or filtered, RST closed, and ICMP unreachable error as filtered.
```
nmap -sM 172.16.82.106
```

### ICMP echo discovery probe

The Nmap ICMP Echo Discovery Probe is a network discovery technique used by Nmap to determine whether a host is active and reachable on a network. This method utilizes the ICMP (Internet Control Message Protocol) Echo Request and Echo Reply messages, which are fundamental components of the ICMP protocol used for network diagnostics and troubleshooting.

`-PE` - ICMP Echo Request (Ping) (ICMP type 8/0) scan to discover whether hosts are up and reachable on a network.
```
nmap -PE 172.16.82.106/27
```

### Timestamp Discovery Probe

The Timestamp Discovery Probe in Nmap uses ICMP Timestamp Requests (ICMP type 13/14) to determine if hosts are up and reachable. This method can sometimes bypass certain network filtering or firewall rules that might block other types of probes.

`-PP` - Uses ICMP Timestamp Request packets (ICMP type 13/14) for host discovery.
```
nmap -PP 172.16.82.96/27
```

### Netmask Request Discovery Probe

Nmap's Netmask Request Discovery Probe works by sending a specific type of ICMP packet known as an ICMP Netmask Request to a target IP address. This packet asks the target host to provide its subnet mask, which is a piece of information used to determine the range of IP addresses within a network.  

`-PM` - Uses ICMP address mask request packets (ICMP type 17/18) for host discovery. This method is less common but can sometimes bypass certain firewall rules that block ICMP Echo Requests.
```
nmap -PM -Pn 172.16.82.106
```

### TCP SYN Discovery Ping

A syn/ack discovery ping sends an empty TCP packet with only the SYN flag set. When sent, this scan expects a RST packet if the port is closed or a SYN/ACK if the port is open. By default it uses only port 80 and is designed to work only for privileged users on Unix boxes. The scan automatically uses a workaround if the user is not privileged. Returns improper results
```
nmap -PS21-50 172.16.82.106
```

### TCP ACK Discovery Ping

A TCP discovery ping works like the SYN Discovery ping but sets the ACK flag instead of the SYN flag. Both are offered to better allow a user access around or through a firewall. Only works on the same network
```
nmap -PA21-50 172.16.82.106
hping3 -c 1 -V -p 80 -s 5050 -A 172.16.82.106 (TCP ACK Scan)
```

### UDP Discovery Ping

A UDP Discovery scan uses the same idea as both the SYN Discovery ping and the ACK Discovery ping. The difference here is that instead of a TCP packet it uses a UDP packet. Packets are empty except for a few ports (53 and 161). ICMP unreachable messages indicate a closed port, any other ICMP message or no response indicates a down/unreachable host, open ports also will drop responses if there is no payload. The lack of true responses makes this an unreliable scan, but it is able to get around firewalls designed for TCP. Does not return a proper response
```
nmap -PU21-50 172.16.82.106
```

### SCTP INIT Scan

A SCTP INIT scan has characteristics of both TCP and UDP with other features as well. This is the SCTP version of the TCP SYN scan and is able to get through most firewalls. It is considered fairly stealthy and gives reliable open, closed, and filtered results. An INIT-ACK shows as open, no response shows as filtered, and ABORT shows as closed.
```
nmap -sY 172.16.82.106
```

### NMAP Timing Options

|Timing Template |	Aggressiveness |	Scan Speed |	Timeouts/Probe Behavior |	Typical Use Case|
|---|---|---|---|---|
|-T0| (Paranoid)| 	Very Cautious |	Very Slow |	Very long timeouts for each probe (e.g., 5+ seconds) |	Stealth scans to avoid detection, very slow.|
|-T1| (Sneaky)| 	Cautious 	|Slow| 	Long timeouts (around 3-5 seconds)| 	Stealthy scan, used to evade detection.|
|-T2| (Polite) |	Moderate |	Slower than normal |	Medium timeouts (around 2-4 seconds) |	Used when trying to avoid detection but still get results, suitable for scanning busy targets.|
|-T3| (Normal) |	Normal |	Normal (default) |	Shorter timeouts (around 1-2 seconds) |	Default for general-purpose scanning, balancing speed and stealth.|
|-T4| (Aggressive) |	Aggressive |	Faster than normal |	Short timeouts (under 1 second)| 	Faster scans, may trigger detection. Ideal for non-sensitive or time-sensitive scans.|
|-T5| (Insane) |	Very Aggressive |	Very Fast| 	Very short timeouts (fractions of a second) |	Extremely fast scans, very likely to be detected. Used in scenarios where speed is crucial and detection isn't a concern.|

## Firewalking

   - Firewalking
       - Firewalking is a technique used to determine if packets can pass through a firewall without being blocked. It involves sending packets with TTL values set to expire just before reaching the firewall, and observing whether ICMP Time Exceeded messages are returned by the firewall or other devices.
       - Firewalking can help identify open ports and services allowed through a firewall, as well as potential security holes or misconfigurations in firewall rules.
       - Firewalking requires careful selection of TTL values and may not always yield conclusive results, especially if the firewall or intermediate devices are configured to block ICMP messages or hide their presence.

   - Traceroute:
       - Traceroute is a tool used to trace the route packets take from the local machine to a destination host. It works by sending packets with incrementally increasing Time-To-Live (TTL) values and observing the ICMP Time Exceeded messages returned by intermediate routers. ** This allows the traceroute tool to map out the network path taken by packets to reach the destination.
       - Traceroute is commonly used to diagnose network connectivity issues, identify routing loops or delays, and troubleshoot network performance problems.
       - Traceroute does not have the capability to bypass firewalls or security devices, as it relies on the cooperation of intermediate routers to return ICMP Time Exceeded messages.
```
traceroute 172.16.82.106
traceroute 172.16.82.106 -p 123
sudo traceroute 172.16.82.106 -I
sudo traceroute 172.16.82.106 -T
sudo traceroute 172.16.82.106 -T -p 443
```

## Scanning with Netcat
```
nc [OPTIONS] [TARGET IP] [TARGET PORT]

nc -h       (Help Menu)
man nc      (Man Pages)
```
`-z` : Port scanning mode i.e. zero I/O mode.

`-v` : Be verbose [use twice -vv to be more verbose].

`-n` : Use numeric-only IP addresses i.e. do not use DNS to resolve ip addresses.

`-w1` : Set time out value to 1. Else it will use the default TCP timeout period of 3-5 seconds.

`-u` : To switch to UDP.

   - Netcat does not use the (`-p`) to specify ports to scan. The (`-p`) is only used with the (`-l`) to specify a listening port.
       - `-p` : Specify the local bind port number for listening. Without this option, netcat will listen on a random ephemeral port.
       - `-l` : Listen mode. Netcat will listen for incoming connections on a random high port or a specified bind port if (`-p`) is used.

   - To specify the ports to scan (connect) they simply need to be entered after the IP address separated by a space.
       - `21 22 23 80 443`
   - You can specify one port or a range of ports using the hyphen (`-`).
       - `1-1023`

   - Netcat does not allow the use of commas (`,`). To separate ports they must be separated by a space.

   - To scan one TCP port
```
nc -nzvw1 [TARGET IP] 443
nc -nzvw1 [TARGET IP] 80
nc -nzvw1 [TARGET IP] 21
nc -nzvw1 [TARGET IP] 22
nc -nzvw1 [TARGET IP] 23
nc -nzvw1 [TARGET IP] 25
```
   - To scan one UDP port
```            
nc -nzuv [TARGET IP] 443
nc -nzuv [TARGET IP] 67
nc -nzuv [TARGET IP] 53
nc -nzuv [TARGET IP] 69
nc -nzuv [TARGET IP] 53
```
   - To scan a range of ports
```
## really fast scanner with 1 timeout value ##
netcat -nzvw1 [TARGET IP] 1-1023
```
   - To scan Discontiguous ports
```
netcat -nzvw1 [TARGET IP] 21-23 25 80 443
```

## Netcat Scan Scripts

Netcat scan scripts are custom scripts that leverage Netcat (nc) for performing various types of network scans, such as port scanning, banner grabbing, and more.

Netcat can only scan one IP address at a time and is not able to scan whole network blocks like NMAP can. We can however create a script using a for loop to scan a range of IP address and ports.

Depending on the flavor of linux you are using, netcat open port output can respond with open (Debian) or `succeeded` (Ubuntu). We will use the `grep -E succ|open`.

`-E (--extended-regexp)` - Interpret PATTERNS as extended regular expressions.

    Create TCP `scan.sh` file:
```
nano scan.sh
```
Copy and paste the following contents into the `scan.sh` file:
```
#!/bin/bash

echo "Enter network address (e.g. 192.168.0): "
read net
echo "Enter starting host range (e.g. 1): "
read start
echo "Enter ending host range (e.g. 254): "
read end
echo "Enter ports space-delimited (e.g. 21-23 80): "
read ports

for ((i=$start; $i<=$end; i++))

do
    nc -nvzw1 $net.$i $ports 2>&1 | grep -E 'succ|open' &
done
wait
# (-v) running verbosely (-v on Linux, -vv on Windows),
# (-n) not resolving names. numeric only IP(no D.S)
# (-z) without sending any data. zero-I/O mode(used for scanning)
# (-w1) waiting no more than 1second for a connection to occur
# (2>&1) redirect STDERR to STDOUT. Results of scan are errors and need to redirect to output to grep
# ( | grep -E 'succ|open') for Debian/Ubuntu to display only open connections
# (&) put the scan into the background to run all scan simultaneous
# (wait) wait for all background process to complete before closing
```
Make the `scan.sh` file executable:
```
chmod +x scan.sh
```
   - Create UDP `udpscan.sh` file:
```
#!/bin/bash

echo "Enter network address (e.g. 192.168.0): "
read net
echo "Enter starting host range (e.g. 1): "
read start
echo "Enter ending host range (e.g. 254): "
read end
echo "Enter ports space-delimited (e.g. 21-23 80): "
read ports

for ((i=$start; $i<=$end; i++))

do
    nc -nuvz $net.$i $ports 2>&1 | grep -E 'succ|open'
done

# (-v) running verbosely (-v on Linux, -vv on Windows),
# (-n) not resolving names. numeric only IP(no D.S)
# (-z) without sending any data. zero-I/O mode(used for scanning)
# (-w1) waiting no more than 1second for a connection to occur
# (2>&1) redirect STDERR to STDOUT. Results of scan are errors and need to redirect to output to grep
# ( | grep -E 'succ|open') for Debian/Ubuntu to display only open connections
```

## Netcat One-Liner Scan

A Netcat one-liner scan is a compact command used to scan a range of ports on a target machine in a single line of code. This technique is useful for quickly checking which ports are open on a target system.

   - Vertical Scanning - One, many, or all ports on one target.
       - TCP
```
nc -nzvw1 172.16.82.106 21-23 80 2>&1 | grep -E 'succ|open'
nc -nzvw1 172.16.82.106 1024-65535 2>&1 | grep -E 'succ|open'
```
       - UDP
```
nc -nuzvw1 172.16.82.106 53 67 68 123 2>&1 | grep -E 'succ|open'
nc -nuzvw1 172.16.82.106 1000-2000 2>&1 | grep -E 'succ|open'
```
   - Horizontal Scanning - Many or all ports on a range of targets.
       - TCP
```
for i in {1..254}; do nc -nvzw1 172.16.82.$i 20-23 80 2>&1 & done | grep -E 'succ|open'
```
       - UDP
```
for i in {1..254}; do nc -nuvzw1 172.16.82.$i 1000-2000 2>&1 & done | grep -E 'succ|open'
```

## Netcat Banner Grabbing

Netcat banner grabbing is a technique used to obtain information about a service running on a specific port by connecting to it and analyzing the banner it presents. Banners often include details about the software version, operating system, or other configurations that can be useful for network reconnaissance and security assessments.

SSH Ports:
```
nc 10.10.0.40 22

SSH-2.0-OpenSSH_7.9p1 Debian-10+deb10u4
```
Telnet ports:
```
nc -t 10.10.0.40 23

Telnet Debian GNU/Linux 10
blue-internet-host-student-19 login:
```
HTTP Ports:
```
echo "GET /" | nc 10.10.0.40 80

This is the webserver on Internet Host
```

## Operating System Information

Linux: `cat /etc/os-release`

Linux: `lsb_release -a`

Linux: `uname -a`

Windows: `systeminfo`

Windows: `ver`

Windows: `wmic os get { Caption, Version, BuildNumber, OSArchitecture }`

## Find

   - The find command is used on Unix-like operating systems (such as Linux and macOS) to search for files and directories within a directory hierarchy based on various criteria. It is a versatile and powerful tool for locating files and performing actions on them.
```
find [where to start searching from] [expression determines what to find] [-options] [what to find] 2> /dev/null
```
```
student@internet-host-student-01:~$ find / -name passwd 2> /dev/null
/usr/bin/passwd
/usr/share/doc/passwd
/usr/share/bash-completion/completions/passwd
/usr/share/lintian/overrides/passwd
/etc/pam.d/passwd
/etc/cron.daily/passwd
/etc/passwd
```
   - `/` - specifies to start searching from system root.

   - `-name *pattern*` - Base of file name (the path with the leading directories removed) matches shell pattern pattern.

   - `-iname *pattern*` - Like -name, but the match is case insensitive.

   - `*filename*` - specify the name of the file to search for. Can use wildcards (*) before or after.

   - `2>/dev/null` - removes error responses such as "Permission denied"

## ARP Scan

As we have learned before, ARP is used to resolve IP addresses to MAC addresses. By exploiting this protocol, we can learn the IPs an MAC addresses of devices in the local network segment. The responses that return are only for the local segment, so the requests must be run internally from the desired location. This is a low level scan that can potentially be overlooked on many networks.
```
sudo arp-scan --interface=eth0 --localnet

sudo arp-scan --interface=eth0 10.1.0.0/24

arping –c 1 –i eth0 172.16.32.2 (can only scan a single host, results vary)

for ip in $(sew 1 254) ; do if ping -c 1 10.1.0.$ip>/dev/null; then echo "10.1.0.$ip UP"; fi ;done

nmap –PR 172.16.32.2(legitimate scan that often does not show results)

nmap -PR -6 fe80::f816:3eff:fed9:5116/64(takes a long time to run)
```

## Network Recon Methodology

**What we need to do:**

   - Gather initial information ( inital access ip address and port(s) )
   - Determine the network range ( /16, /20, /24, /27 )
   - Identify active machines ( ping or port scan )
   - Discover open ports and access points ( port scan)
   - Fingerprint the operating system ( banner grab ports or sniff traffic )
   - Uncover services on ports ( banner grab open ports )
   - Map the network ( physically draw network starting from your system and build a tree view )

    1. **Conduct Passive recon** on your (or remote) system (if needed)
       - `ip addr` (`ipconfig/ifconfig`) – this will show all interfaces and IP address as well as MAC, CIDR, and Broadcast
       - Use reverse subnetting to determine the network range (first - last IP) from the IP/CIDR.
           - `10.10.0.40/27`
           - Network = `10.10.0.32`
           - Usable range = `10.10.0.33` - `10.10.0.62`
           - Broadcast = `10.10.0.63`
       - `ip neighbor` (`arp -a`) – will display any systems that the local system has communicated with recently.
           - May show some systems, but any systems it has not communicated with will not be in the database.
       - `ss` (`netstat`) – display any TCP/UDP listening ports.
           - Use to see all TCP/UDP ports listening on 0.0.0.0.
           - May see ports that you did not see from active scanning.
       - `ps -ef` – identify any services/daemons running on the system.
           - Look for specific services like running processes, firewall, or IDS/IPS software.
       - `find` – use to search for specific files/folders.
           - `find / -name *name* 2> /dev/null`
           - `find / -iname *name* 2> /dev/null`
       - `*` are wildcards that can be used before/after a name.
       - Share folder (`/usr/share/cctc`) – any files stored on the system
               - `tcpdump/Wireshark` – (if accessible) to sniff traffic.
       - Use `which` or `whereis` to identify any other programs installed on the system with their binary paths.

    2. **Conduct Active recon** (scan) from your box to find other systems on the same network.
       - `./scan.sh` or `nmap` - scan from your box
       - `proxychains ./scan.sh` or `proxychains nmap` - scan thru dynamic tunnel to enumerate from proxy.

    3. **Conduct Network Forensics**
       - Identify IP address, TCP/UDP ports you find and document them on your network map.
       - Create a tree view map with your system being the root and each system accessible from your box as branches.
       - Enumerate TCP and UDP ports to identify services running on them.
       - Interact with services you see (FTP, curl, wget, firefox, NC, etc.).
           - FTP (21) or HTTP(s) (80/443) you can use:
               - `curl http://10.0.0.1` or `curl ftp://10.0.0.1`
               - `wget -r http://10.0.0.1` or `wget -r http://10.0.0.1:2000` or `wget -r ftp://10.0.0.1`
           - SSH (port 22)
           - Telnet (23)
           - Banner grab other ports:
               - `nc 10.0.0.1 1111`
               - `telnet 10.0.0.1 2222`
       - Pull files using scp:
           - `scp student@10.0.0.1:/usr/share/cctc/flag.png .`

    4. **Review collected data** from the systems (review file information and clues)
       - systematically download all data to your system to analyze and record.
       - Identify any possible pivot system(s) you can use to find more systems. (needs SSH or Telnet access)
       - does any system have either ssh or telnet open to pivot thru?

    5. **Conduct Active Enumeration**
       - Remote to pivot (if applicable).
       - Conduct passive recon on the pivot box (same as step 1). Is it a viable pivot?
       - (Back on your box) Build a tunnel to pivot (with `-D`, `-L`, or `-R` if needed).
           - Build Dynamic Tunnel to pivot:
               - `ssh user@ip-address -D 9050`
           - Build a Local or Remote tunnel:
               - `Your-box$` `ssh user@ip-address -L 1111:next-pivot-ip:22`
               - `Remote-box$` `ssh user@ip-address -R 1111:localhost:22`

    6. **Conduct Active recon** (scan through Proxychains) from your box to find other systems accessible from your new pivot.
       - `proxychains ./scan.sh` - scan thru dynamic tunnel to enumerate from proxy.

    7. **Conduct Network Forensics**
       - Identify IP address, TCP/UDP ports you find and document them on your network map.
       - Create the additional tree "branches" on your map.
       - Enumerate TCP and UDP ports to identify services running on them.
       - Interact with services you see using proxychains (FTP, curl, wget, NC, ssh, telnet, etc.):
           - FTP (21) or HTTP(s) (80/443) you can use:
               - `proxychains curl http://10.0.0.1` or `proxychains curl ftp://10.0.0.1`
               - `proxychains wget -r http://10.0.0.1` or `wget -r http://10.0.0.1:2000 or proxychains wget -r ftp://10.0.0.1`
           - `proxychains ssh` (port 22)
           - `proxychains telnet` (23)
           - Banner grab other ports:
               - `proxychains nc 10.0.0.1 1111`
               - `proxychains telnet 10.0.0.1 2222`
       - Pull files using scp:
           - `proxychains scp student@10.0.0.1:/usr/share/cctc/flag.png .`

